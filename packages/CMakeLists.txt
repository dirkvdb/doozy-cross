CMAKE_MINIMUM_REQUIRED(VERSION 3.0)
CMAKE_POLICY(VERSION 3.0)
INCLUDE(ExternalProject)

IF (CMAKE_CROSSCOMPILING)
    SET(CFLAGS "-isystem ${CMAKE_BINARY_DIR}/local/include ${CMAKE_C_FLAGS}")
    SET(CXXFLAGS "-isystem ${CMAKE_BINARY_DIR}/local/include ${CMAKE_CXX_FLAGS}")
    IF (HOST MATCHES i686-apple-darwin)
        SET(LDFLAGS "-L${CMAKE_BINARY_DIR}/local/lib -m32")
    ELSE ()
        SET(LDFLAGS -L${CMAKE_BINARY_DIR}/local/lib)
    ENDIF ()
ENDIF ()

SET(CROSS_ARGS CC=${CMAKE_C_COMPILER} CXX=${CMAKE_CXX_COMPILER} AR=${CMAKE_AR} RANLIB=${CMAKE_RANLIB} CFLAGS=${CFLAGS} CPPFLAGS=${CFLAGS} CXXFLAGS=${CXXFLAGS} LDFLAGS=${LDFLAGS})

ADD_SUBDIRECTORY(ffmpeg)
ADD_SUBDIRECTORY(libjpeg-turbo)
ADD_SUBDIRECTORY(libmad)
ADD_SUBDIRECTORY(openal)
ADD_SUBDIRECTORY(flac)
ADD_SUBDIRECTORY(sqlite)
ADD_SUBDIRECTORY(libupnp)
ADD_SUBDIRECTORY(zlib)
ADD_SUBDIRECTORY(libpng)
ADD_SUBDIRECTORY(taglib)
ADD_SUBDIRECTORY(libxdg-basedir)

IF (NOT CMAKE_SYSTEM_NAME MATCHES "Darwin")
    ADD_SUBDIRECTORY(alsa-lib)
ENDIF ()

ADD_DEPENDENCIES(libpng zlib)
ADD_DEPENDENCIES(taglib zlib)

IF (NOT CMAKE_SYSTEM_NAME MATCHES "Darwin")
    ADD_DEPENDENCIES(openal-soft alsa-lib)
ENDIF ()